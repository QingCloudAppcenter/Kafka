{{- $roleMap := map "kafka" "kafka" "client" "kafka-manager" }}
{{- $myRole := index $roleMap (getv "/host/role") }}
{{- $myIp := getv "/host/ip" }}
flush /opt/app/current/conf/caddy/caddyfile << CADDYFILE_EOF
{{ $myIp }}:80 {
  {{- with getv "/env/web.console.password" "" }}
  basicauth / "{{ getv "/env/web.console.username" "admin" }}" "{{ . }}"
  {{- end }}
  root /data/{{ $myRole }}
  gzip
  browse
  tls off
}
CADDYFILE_EOF

